<!DOCTYPE html>
<html lang="vi" id="main-html">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>QR Position Tool - Administration Dept</title>
    <!-- Favicon inline QR Icon -->
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üî≥</text></svg>">
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Lexend+Deca:wght@300;400;700&display=swap" rel="stylesheet">
    <script>
        tailwind.config = {
            darkMode: 'class',
        }
    </script>
    <style>
        body {
            font-family: 'Lexend Deca', sans-serif;
            font-weight: 300;
            transition: background-color 0.3s ease, color 0.3s ease;
        }
        #draggable {
            cursor: move;
            user-select: none;
            border: 2px dashed #3b82f6;
            z-index: 50;
            aspect-ratio: 1 / 1; 
        }
        .canvas-container {
            background-image: radial-gradient(#cbd5e1 1px, transparent 1px);
            background-size: 20px 20px;
        }
        .dark .canvas-container {
            background-image: radial-gradient(#334155 1px, transparent 1px);
        }
        input[type=range] {
            height: 6px;
            -webkit-appearance: none;
            width: 100%;
            background: #d1d5db;
            border-radius: 5px;
        }
        .dark input[type=range] {
            background: #475569;
        }
        input[type=range]::-webkit-slider-thumb {
            -webkit-appearance: none;
            height: 18px;
            width: 18px;
            border-radius: 50%;
            background: #3b82f6;
            cursor: pointer;
            box-shadow: 0 0 10px rgba(59, 130, 246, 0.5);
        }
        /* Custom scrollbar */
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 10px; }
        .dark ::-webkit-scrollbar-thumb { background: #475569; }
        
        .header-text-preview {
            white-space: pre-line;
            line-height: 1.6;
        }
    </style>
</head>
<body class="bg-slate-100 dark:bg-slate-950 min-h-screen p-4 md:p-8 text-slate-800 dark:text-slate-200">

    <div class="max-w-7xl mx-auto bg-white dark:bg-slate-900 rounded-3xl shadow-2xl overflow-hidden flex flex-col md:flex-row min-h-[85vh] border border-slate-200 dark:border-slate-800">
        <!-- Sidebar -->
        <div class="w-full md:w-80 p-6 bg-slate-50 dark:bg-slate-900/50 border-r border-slate-200 dark:border-slate-800 flex flex-col gap-6">
            <div class="flex items-center justify-between border-b-2 border-blue-500 pb-4">
                <h2 class="text-xl font-bold text-slate-900 dark:text-white">Email Setup</h2>
                <button id="dark-toggle" class="p-2 rounded-lg bg-slate-200 dark:bg-slate-800 hover:ring-2 ring-blue-400 transition-all">
                    <span id="dark-icon-sun" class="hidden dark:block">‚òÄÔ∏è</span>
                    <span id="dark-icon-moon" class="block dark:hidden">üåô</span>
                </button>
            </div>
            
            <div class="space-y-5 overflow-y-auto max-h-[70vh] pr-2">
                <!-- N·ªôi dung l·ªùi ch√†o -->
                <div class="bg-white dark:bg-slate-800 p-4 rounded-xl shadow-sm border border-slate-200 dark:border-slate-700 space-y-3">
                    <p class="text-xs text-slate-400 uppercase font-bold tracking-wider">L·ªùi ch√†o tr√™n c√πng</p>
                    <textarea id="header-text-input" rows="6" class="w-full border dark:border-slate-600 rounded-md px-2 py-2 font-light text-[11px] bg-white dark:bg-slate-700 text-slate-600 dark:text-slate-200 outline-none focus:ring-1 focus:ring-blue-400 leading-relaxed">Ch√†o anh/chi,
YEP l√† ƒë·ªÉ vui, m√† mu·ªën vui th√¨ b·ª•ng ph·∫£i kh·ªèe!! 
üëâ <a href=''> Click nh·∫π m·ªôt gi√¢y ‚Äì Ti·ªác vui h·∫øt s·∫£y </a>

BTC s·∫Ω d·ª±a v√†o ƒë√¢y ƒë·ªÉ thi·∫øt k·∫ø th·ª±c ƒë∆°n "v·ª´a v·∫∑n" nh·∫•t cho b·∫°n. 
ƒê·ª´ng qu√™n "tr√¨nh" th∆∞ m·ªùi b√™n d∆∞·ªõi ƒë·ªÉ check-in th·∫≠t m∆∞·ª£t m√† nha!</textarea>
                </div>

                <!-- C·∫•u h√¨nh ·∫¢nh -->
                <div class="bg-white dark:bg-slate-800 p-4 rounded-xl shadow-sm border border-slate-200 dark:border-slate-700 space-y-3">
                    <div>
                        <label class="text-[10px] text-slate-500 dark:text-slate-400 font-bold uppercase tracking-tighter">Link ·∫¢nh n·ªÅn</label>
                        <input type="text" id="bg-url-input" value="https://res.cloudinary.com/dzv2r1azb/image/upload/69b5488815b89ae6c3a9_rq7tii" class="w-full border dark:border-slate-600 rounded-md px-2 py-1 font-mono text-[10px] bg-white dark:bg-slate-700 text-slate-600 dark:text-slate-200 outline-none">
                    </div>
                    <div>
                        <label class="text-[10px] text-slate-500 dark:text-slate-400 font-bold uppercase tracking-tighter">Link QR Code</label>
                        <input type="text" id="qr-url-input" value="https://res.cloudinary.com/dzv2r1azb/image/upload/v1766729747/qr-generator/qr_1766729746571_1.png" class="w-full border dark:border-slate-600 rounded-md px-2 py-1 font-mono text-[10px] bg-white dark:bg-slate-700 text-slate-600 dark:text-slate-200 outline-none">
                    </div>
                </div>

                <!-- K√≠ch th∆∞·ªõc -->
                <div class="bg-white dark:bg-slate-800 p-4 rounded-xl shadow-sm border border-slate-200 dark:border-slate-700">
                    <div class="flex justify-between items-center gap-2 mb-3">
                        <span class="text-xs font-bold text-slate-400 uppercase">R·ªông khung:</span>
                        <input type="number" id="canvas-w" value="600" class="w-20 text-right border dark:border-slate-600 rounded-md px-2 py-1 font-mono text-blue-600 dark:text-blue-400 bg-white dark:bg-slate-700 outline-none">
                    </div>
                    <button id="autofit-btn" class="w-full py-2 text-[10px] bg-blue-50 dark:bg-blue-900/30 text-blue-700 dark:text-blue-300 hover:bg-blue-100 dark:hover:bg-blue-900/50 rounded font-black uppercase transition-all">
                        Kh·ªõp khung v·ªõi ·∫£nh g·ªëc
                    </button>
                </div>

                <!-- T·ªça ƒë·ªô -->
                <div class="grid grid-cols-2 gap-3">
                    <div class="bg-white dark:bg-slate-800 p-3 rounded-xl border border-slate-200 dark:border-slate-700 text-center">
                        <p class="text-[10px] text-slate-400 uppercase font-black mb-1">Top</p>
                        <p id="top-val" class="text-lg font-mono text-slate-700 dark:text-slate-200 font-bold">0</p>
                    </div>
                    <div class="bg-white dark:bg-slate-800 p-3 rounded-xl border border-slate-200 dark:border-slate-700 text-center">
                        <p class="text-[10px] text-slate-400 uppercase font-black mb-1">Left</p>
                        <p id="left-val" class="text-lg font-mono text-slate-700 dark:text-slate-200 font-bold">0</p>
                    </div>
                </div>

                <!-- Size QR -->
                <div class="bg-white dark:bg-slate-800 p-4 rounded-xl shadow-sm border border-slate-200 dark:border-slate-700">
                    <div class="flex justify-between items-center mb-2">
                        <p class="text-xs text-slate-400 uppercase font-bold">Size QR (px)</p>
                        <input type="number" id="size-input" value="100" class="w-16 text-right border dark:border-slate-600 rounded px-1 text-blue-600 dark:text-blue-400 bg-white dark:bg-slate-700 font-mono font-bold">
                    </div>
                    <input type="range" id="size-range" min="20" max="400" value="100" class="cursor-pointer">
                </div>

                <div class="pt-2">
                    <button id="copy-btn" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-4 px-4 rounded-xl shadow-lg transition-all active:scale-95 flex flex-col items-center gap-1">
                        <div class="flex items-center gap-2">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                                <path d="M8 3a1 1 0 011-1h2a1 1 0 110 2H9a1 1 0 01-1-1z" />
                                <path d="M6 3a2 2 0 00-2 2v11a2 2 0 002 2h8a2 2 0 002-2V5a2 2 0 00-2-2 3 3 0 01-3 3H9a3 3 0 01-3-3z" />
                            </svg>
                            <span>COPY FULL TEMPLATE</span>
                        </div>
                        <span class="text-[10px] font-normal opacity-80">(Stable Table-Padding)</span>
                    </button>
                    <p id="toast" class="mt-3 text-center text-green-600 font-bold opacity-0 transition-opacity text-sm bg-green-50 dark:bg-green-900/20 py-1 rounded-full border border-green-100 dark:border-green-900/30">ƒê√£ copy to√†n b·ªô m√£!</p>
                </div>
            </div>
        </div>

        <!-- Workspace -->
        <div class="flex-1 p-6 flex flex-col items-center justify-start overflow-auto canvas-container bg-slate-100 dark:bg-slate-950">
            <div id="email-mockup" class="bg-white shadow-2xl border border-slate-300 dark:border-slate-800" style="width: 600px; margin: 0 auto;">
                <!-- TI√äU ƒê·ªÄ/L·ªúI CH√ÄO PREVIEW -->
                <div id="header-text-preview" class="p-8 text-slate-700 dark:text-slate-300 border-b border-slate-100 dark:border-slate-700 header-text-preview text-sm font-light">
                    <!-- N·ªôi dung JS t·ª± ƒë·ªï v√†o ƒë√¢y -->
                </div>

                <!-- KH·ªêI ·∫¢NH CH√çNH -->
                <div id="container" class="relative overflow-hidden" style="width: 600px; margin: 0 auto;">
                    <img src="https://res.cloudinary.com/dzv2r1azb/image/upload/69b5488815b89ae6c3a9_rq7tii" 
                         alt="Background" 
                         class="w-full h-auto pointer-events-none block"
                         id="base-img">
                    
                    <img id="draggable" 
                         src="https://res.cloudinary.com/dzv2r1azb/image/upload/v1766729747/qr-generator/qr_1766729746571_1.png" 
                         style="position:absolute; top: 100px; left: 100px; width: 100px; height: 100px;"
                         alt="QR Code">
                </div>

                <!-- SIGNATURE -->
                <div class="p-8 text-slate-600 bg-white border-t border-slate-100 text-left">
                    <div style='font-family: "Lexend Deca", sans-serif; font-weight: 300; font-size: 8pt;'>
                        <div style="border-top: 1px solid #201F1E; width: 120px; margin: 5px 0 4px 0;"></div>
                        <p style="color:#002060; font-weight: 700;">Administration Dept.</p>
                        <p style="color:blue; text-decoration: underline;">administration@coteccons.vn</p>
                        <div class="mt-1 mb-4">
                            <img src="https://res.cloudinary.com/dzv2r1azb/image/upload/Picture1_y70qor" width="100%" style="max-width: 100%; height: auto; display: block;" alt="Signature Image">
                        </div>
                        <p style="color:black; font-weight: 700;">COTECCONS CONSTRUCTION JOINT STOCK COMPANY</p>
                        <p style="color:#595959;">236/6 Dien Bien Phu St., Gia Dinh Ward, Ho Chi Minh City</p>
                        <p style="color:#595959;">(+84) 28 3514 2255</p>
                        <p style="color:#595959;">0303443233 (Tax Code)</p>
                        <p style="color:blue; text-decoration: underline;">www.coteccons.vn</p>
                    </div>
                </div>
            </div>
            <p class="mt-4 text-[11px] text-slate-400 uppercase tracking-widest font-bold font-mono text-center">K√©o QR v√† b·∫•m Copy ƒë·ªÉ l·∫•y m√£ ho√†n ch·ªânh</p>
        </div>
    </div>

    <script>
        const draggable = document.getElementById('draggable');
        const container = document.getElementById('container');
        const emailMockup = document.getElementById('email-mockup');
        const headerPreview = document.getElementById('header-text-preview');
        const headerInput = document.getElementById('header-text-input');
        
        const topDisplay = document.getElementById('top-val');
        const leftDisplay = document.getElementById('left-val');
        const copyBtn = document.getElementById('copy-btn');
        const toast = document.getElementById('toast');
        const sizeInput = document.getElementById('size-input');
        const sizeRange = document.getElementById('size-range');
        const canvasWInput = document.getElementById('canvas-w');
        const baseImg = document.getElementById('base-img');
        const bgUrlInput = document.getElementById('bg-url-input');
        const qrUrlInput = document.getElementById('qr-url-input');
        const autofitBtn = document.getElementById('autofit-btn');
        const darkToggle = document.getElementById('dark-toggle');
        const htmlRoot = document.getElementById('main-html');

        let isDragging = false;
        let startX, startY, startTop, startLeft;

        // DARK MODE LOGIC
        darkToggle.addEventListener('click', () => {
            htmlRoot.classList.toggle('dark');
        });

        // HEADER TEXT LOGIC
        function updateHeaderPreview() {
            headerPreview.innerText = headerInput.value;
        }
        headerInput.addEventListener('input', updateHeaderPreview);

        function updateDisplay() {
            topDisplay.innerText = Math.round(parseFloat(draggable.style.top)) || 0;
            leftDisplay.innerText = Math.round(parseFloat(draggable.style.left)) || 0;
        }

        function updateSize(newSize) {
            newSize = Math.max(10, Math.min(500, newSize));
            draggable.style.width = newSize + 'px';
            draggable.style.height = newSize + 'px';
            sizeInput.value = newSize;
            sizeRange.value = newSize;
            updateDisplay();
        }

        function setCanvasWidth(val) {
            container.style.width = val + 'px';
            emailMockup.style.width = val + 'px';
            canvasWInput.value = val;
            updateDisplay();
        }

        canvasWInput.addEventListener('input', () => setCanvasWidth(canvasWInput.value || 600));
        autofitBtn.addEventListener('click', () => setCanvasWidth(baseImg.naturalWidth || 600));
        
        bgUrlInput.addEventListener('input', () => { baseImg.src = bgUrlInput.value; });
        qrUrlInput.addEventListener('input', () => { draggable.src = qrUrlInput.value; });

        sizeRange.addEventListener('input', (e) => updateSize(e.target.value));
        sizeInput.addEventListener('change', (e) => updateSize(e.target.value));

        draggable.addEventListener('mousedown', (e) => {
            isDragging = true;
            startX = e.clientX;
            startY = e.clientY;
            startTop = parseInt(draggable.style.top) || 0;
            startLeft = parseInt(draggable.style.left) || 0;
            e.preventDefault();
        });

        window.addEventListener('mousemove', (e) => {
            if (!isDragging) return;
            draggable.style.top = (startTop + (e.clientY - startY)) + 'px';
            draggable.style.left = (startLeft + (e.clientX - startX)) + 'px';
            updateDisplay();
        });

        window.addEventListener('mouseup', () => isDragging = false);

        copyBtn.addEventListener('click', () => {
            const top = parseInt(draggable.style.top) || 0;
            const left = parseInt(draggable.style.left) || 0;
            const qrSize = parseInt(draggable.style.width) || 100;
            const canvasW = canvasWInput.value || 600;
            const imgH = baseImg.offsetHeight;
            const bSrc = baseImg.src;
            const qSrc = draggable.src;
            
            const bottomSpacer = imgH - top - qrSize;

            // X·ª≠ l√Ω xu·ªëng d√≤ng cho header text
            const headerHtml = headerInput.value.replace(/\n/g, '<br>');

            const fullHtml = `<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <link href="https://fonts.googleapis.com/css2?family=Lexend+Deca:wght@300;700&display=swap" rel="stylesheet">
  <style>
    * { font-family: 'Lexend Deca', sans-serif !important; }
  </style>
</head>
<body style="margin:0; padding:0; background-color:#f4f4f4;">
  <table width="100%" border="0" cellpadding="0" cellspacing="0" role="presentation">
    <tr>
      <td align="center" style="padding: 20px 0;">
        <table border="0" cellpadding="0" cellspacing="0" role="presentation" width="${canvasW}" style="width:${canvasW}px; margin: 0 auto; border-collapse: collapse; background-color:#ffffff;">
          
          <!-- L·ªúI CH√ÄO -->
          <tr>
            <td align="left" style="padding: 40px; color: #333333; font-size: 14px; font-weight: 300; line-height: 1.6;">
              ${headerHtml}
            </td>
          </tr>

          <!-- KH·ªêI ·∫¢NH CH√çNH -->
          <tr>
            <td align="left">
              <table border="0" cellpadding="0" cellspacing="0" role="presentation" width="100%" style="width:100%; border-collapse: collapse;">
                <tr>
                  <td background="${bSrc}" bgcolor="#ffffff" width="${canvasW}" height="${imgH}" valign="top" style="background-image: url('${bSrc}'); background-repeat: no-repeat; background-size: 100% auto; vertical-align: top;">
                    <!--[if gte mso 9]>
                    <v:rect xmlns:v="urn:schemas-microsoft-com:vml" fill="true" stroke="false" style="width:${canvasW}px;height:${imgH}px;">
                      <v:fill type="frame" src="${bSrc}" color="#ffffff" />
                      <v:textbox inset="0,0,0,0">
                    <![endif]-->
                    <div style="line-height: 0; font-size: 0; text-align: left;">
                      <div style="padding-top: ${top}px; padding-left: ${left}px;">
                        <table border="0" cellpadding="0" cellspacing="0" role="presentation" width="${qrSize}" style="width:${qrSize}px; border-collapse: collapse;">
                          <tr>
                            <td style="line-height: 0; font-size: 0;">
                              <img src="${qSrc}" width="${qrSize}" height="${qrSize}" border="0" style="display: block; width: ${qrSize}px; height: ${qrSize}px; border: 0;" alt="QR">
                            </td>
                          </tr>
                        </table>
                      </div>
                      <div style="height: ${Math.max(0, bottomSpacer)}px; line-height: ${Math.max(0, bottomSpacer)}px; font-size: 1px;">&nbsp;</div>
                    </div>
                    <!--[if gte mso 9]></v:textbox></v:rect><![endif]-->
                  </td>
                </tr>
              </table>
            </td>
          </tr>

          <!-- SIGNATURE AREA -->
          <tr>
            <td align="left" style="padding: 40px; border-top: 1px solid #eeeeee;">
              <div id="Signature" style="font-family: 'Lexend Deca', sans-serif; font-weight: 300; text-align: left;">
                <div style="border-top: 1px solid #201F1E; width: 120px; margin: 5px 0 4px 0; line-height: 0; font-size: 0;">&nbsp;</div>
                <p style='margin:0;'><b><span style='font-size:8.0pt;color:#002060;font-weight:700;'>Administration Dept.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></b></p>
                <p style='margin:0;'><u><span style='font-size:8.0pt;color:blue;'><a href="mailto:administration@coteccons.vn" style="color:blue;text-decoration:underline;">administration@coteccons.vn</a></span></u></p>
                <div style="width: 100%; max-width: ${canvasW}px; margin-top: 1px; line-height: 0;">
                  <img border="0" width="${canvasW}" src="https://res.cloudinary.com/dzv2r1azb/image/upload/Picture1_y70qor" style='max-width:100%; height:auto; display:block; margin:0; border:0;'>
                </div>
                <p style='margin:0;'><b><span style='font-size:8.0pt;color:black;font-weight:700;'>COTECCONS CONSTRUCTION JOINT STOCK COMPANY</span></b></p>
                <p style='margin:0;'><span style='font-size:8.0pt;color:#595959;'>236/6 Dien Bien Phu St., Gia Dinh Ward, Ho Chi Minh City</span></p>
                <p style='margin:0;'><span style='font-size:8.0pt;color:#595959;'>(+84) 28 3514 2255</span></p>
                <p style='margin:0;'><span style='font-size:8.0pt;color:#595959;'>0303443233 (Tax Code)</span></p>
                <p style='margin:0;'><u><span style='font-size:8.0pt;color:blue;'><a href="http://www.coteccons.vn/" style="color:blue;text-decoration:underline;">www.coteccons.vn</a></span></u></p>
                <p style='margin-top:10px; text-align:justify; font-size:8pt; color:#767171;'>The contents of this email and any attachments are confidential and intended solely for the use of the individual or entity as addressed recipient(s). If you are not the intended recipient, do not copy, disseminate, or use it for any purpose or disclose its contents. Please delete this email and notify the sender immediately if you have received this in error.</p>
                <p style='margin-top:5px; margin-bottom:8.0pt; text-align:justify; font-size:8pt; color:#767171;'>Please consider the environment before printing this email.</p>
              </div>
            </td>
          </tr>
        </table>
      </td>
    </tr>
  </table>
</body>
</html>`;
            
            const el = document.createElement('textarea');
            el.value = fullHtml;
            document.body.appendChild(el);
            el.select();
            document.execCommand('copy');
            document.body.removeChild(el);
            
            toast.style.opacity = '1';
            setTimeout(() => { toast.style.opacity = '0'; }, 3000);
        });

        // Initialize preview
        baseImg.onload = () => { updateDisplay(); };
        updateHeaderPreview();
        updateDisplay();
    </script>
</body>
</html>
