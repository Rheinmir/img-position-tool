<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Công cụ xác định tọa độ QR Code - Chuẩn Email Marketing</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        #draggable {
            cursor: move;
            user-select: none;
            border: 2px dashed #3b82f6;
            z-index: 50;
            aspect-ratio: 1 / 1; 
        }
        .canvas-container {
            background-image: radial-gradient(#cbd5e1 1px, transparent 1px);
            background-size: 20px 20px;
        }
        input[type=range] {
            height: 6px;
            -webkit-appearance: none;
            width: 100%;
            background: #d1d5db;
            border-radius: 5px;
        }
        input[type=range]::-webkit-slider-thumb {
            -webkit-appearance: none;
            height: 18px;
            width: 18px;
            border-radius: 50%;
            background: #3b82f6;
            cursor: pointer;
        }
    </style>
</head>
<body class="bg-slate-100 min-h-screen p-4 md:p-8 font-sans text-slate-800">

    <div class="max-w-7xl mx-auto bg-white rounded-2xl shadow-2xl overflow-hidden flex flex-col md:flex-row min-h-[85vh]">
        <!-- Sidebar -->
        <div class="w-full md:w-80 p-6 bg-slate-50 border-r border-slate-200 flex flex-col gap-6">
            <div>
                <h2 class="text-xl font-bold text-slate-900 mb-1 border-b-2 border-blue-500 pb-2">Cấu hình Email</h2>
                <p class="text-[11px] text-slate-500 italic mt-2 text-blue-600 font-bold uppercase">Tự động xuất code chuẩn Outlook/Gmail</p>
            </div>
            
            <div class="space-y-5">
                <div class="bg-white p-4 rounded-xl shadow-sm border border-slate-200">
                    <p class="text-xs text-slate-400 uppercase font-black mb-3 tracking-wider">Khung Email (px)</p>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-sm font-medium">Chiều rộng:</span>
                            <input type="number" id="canvas-w" value="600" class="w-20 text-right border rounded-md px-2 py-1 font-mono text-blue-600 outline-none">
                        </div>
                    </div>
                </div>

                <div class="grid grid-cols-2 gap-3">
                    <div class="bg-blue-50 p-3 rounded-xl border border-blue-100 text-center">
                        <p class="text-[10px] text-blue-500 uppercase font-black mb-1">Top (px)</p>
                        <p id="top-val" class="text-2xl font-mono text-blue-700 font-bold">640</p>
                    </div>
                    <div class="bg-blue-50 p-3 rounded-xl border border-blue-100 text-center">
                        <p class="text-[10px] text-blue-500 uppercase font-black mb-1">Left (px)</p>
                        <p id="left-val" class="text-2xl font-mono text-blue-700 font-bold">440</p>
                    </div>
                </div>

                <div class="bg-white p-4 rounded-xl shadow-sm border border-slate-200">
                    <div class="flex justify-between items-center mb-3">
                        <p class="text-xs text-slate-400 uppercase font-black tracking-wider">Size QR (px)</p>
                        <input type="number" id="size-input" value="100" class="w-16 text-right border border-slate-200 rounded px-1 text-blue-600 font-mono font-bold">
                    </div>
                    <input type="range" id="size-range" min="20" max="400" value="100" class="cursor-pointer">
                </div>

                <div class="pt-2">
                    <button id="copy-btn" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-4 px-4 rounded-xl shadow-lg transition-all active:scale-95 flex flex-col items-center gap-1">
                        <div class="flex items-center gap-2">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                                <path d="M8 3a1 1 0 011-1h2a1 1 0 110 2H9a1 1 0 01-1-1z" />
                                <path d="M6 3a2 2 0 00-2 2v11a2 2 0 002 2h8a2 2 0 002-2V5a2 2 0 00-2-2 3 3 0 01-3 3H9a3 3 0 01-3-3z" />
                            </svg>
                            <span>COPY CODE BULLETPROOF</span>
                        </div>
                        <span class="text-[10px] font-normal opacity-80">(Chống vỡ khung trong Outlook)</span>
                    </button>
                    <p id="toast" class="mt-3 text-center text-green-600 font-bold opacity-0 transition-opacity text-sm bg-green-50 py-1 rounded-full border border-green-100">Đã copy code chuẩn Table/VML!</p>
                </div>

                <div class="text-[11px] text-slate-500 bg-slate-100 p-4 rounded-xl border border-slate-200 space-y-2">
                    <p class="font-black text-slate-700 mb-1 uppercase text-[10px]">Lưu ý kỹ thuật:</p>
                    <p>• Tool tự tính toán <b>VML</b> cho Outlook Desktop.</p>
                    <p>• Dùng <b>Table Background</b> thay vì Absolute.</p>
                    <p>• Phím mũi tên để nhích 1px.</p>
                </div>
            </div>
        </div>

        <!-- Workspace -->
        <div class="flex-1 p-6 flex flex-col items-center justify-start overflow-auto canvas-container bg-slate-100">
            <div id="container" class="relative bg-white shadow-2xl border border-slate-300 overflow-hidden" style="width: 600px;">
                <!-- Ảnh nền -->
                <img src="https://res.cloudinary.com/dzv2r1azb/image/upload/69b5488815b89ae6c3a9_rq7tii" 
                     alt="Background" 
                     class="w-full h-auto pointer-events-none block"
                     id="base-img">
                
                <!-- Ảnh QR -->
                <img id="draggable" 
                     src="https://res.cloudinary.com/dzv2r1azb/image/upload/v1766729747/qr-generator/qr_1766729746571_1.png" 
                     style="position:absolute; top: 640px; left: 440px; width: 100px; height: 100px;"
                     alt="QR Code">
            </div>
            <p class="mt-4 text-[11px] text-slate-400 uppercase tracking-widest font-bold font-mono">Kéo thả để xác định vị trí thực tế trong mail</p>
        </div>
    </div>

    <script>
        const draggable = document.getElementById('draggable');
        const container = document.getElementById('container');
        const topDisplay = document.getElementById('top-val');
        const leftDisplay = document.getElementById('left-val');
        const copyBtn = document.getElementById('copy-btn');
        const toast = document.getElementById('toast');
        const sizeInput = document.getElementById('size-input');
        const sizeRange = document.getElementById('size-range');
        const canvasWInput = document.getElementById('canvas-w');
        const baseImg = document.getElementById('base-img');

        let isDragging = false;
        let startX, startY, startTop, startLeft;

        function updateDisplay() {
            topDisplay.innerText = Math.round(parseFloat(draggable.style.top));
            leftDisplay.innerText = Math.round(parseFloat(draggable.style.left));
        }

        function updateSize(newSize) {
            newSize = Math.max(10, Math.min(400, newSize));
            draggable.style.width = newSize + 'px';
            draggable.style.height = newSize + 'px';
            sizeInput.value = newSize;
            sizeRange.value = newSize;
        }

        canvasWInput.addEventListener('input', () => {
            container.style.width = (canvasWInput.value || 600) + 'px';
        });

        sizeRange.addEventListener('input', (e) => updateSize(e.target.value));
        sizeInput.addEventListener('change', (e) => updateSize(e.target.value));

        draggable.addEventListener('mousedown', (e) => {
            isDragging = true;
            startX = e.clientX;
            startY = e.clientY;
            startTop = parseInt(draggable.style.top) || 0;
            startLeft = parseInt(draggable.style.left) || 0;
            draggable.style.borderStyle = "solid";
            e.preventDefault();
        });

        window.addEventListener('mousemove', (e) => {
            if (!isDragging) return;
            draggable.style.top = (startTop + (e.clientY - startY)) + 'px';
            draggable.style.left = (startLeft + (e.clientX - startX)) + 'px';
            updateDisplay();
        });

        window.addEventListener('mouseup', () => {
            isDragging = false;
            draggable.style.borderStyle = "dashed";
        });

        window.addEventListener('keydown', (e) => {
            let top = parseInt(draggable.style.top) || 0;
            let left = parseInt(draggable.style.left) || 0;
            const step = e.shiftKey ? 10 : 1;
            if (e.key === 'ArrowUp') draggable.style.top = (top - step) + 'px';
            if (e.key === 'ArrowDown') draggable.style.top = (top + step) + 'px';
            if (e.key === 'ArrowLeft') draggable.style.left = (left - step) + 'px';
            if (e.key === 'ArrowRight') draggable.style.left = (left + step) + 'px';
            if (['ArrowUp', 'ArrowDown', 'ArrowLeft', 'ArrowRight'].includes(e.key)) {
                e.preventDefault();
                updateDisplay();
            }
        });

        copyBtn.addEventListener('click', () => {
            const top = parseInt(draggable.style.top);
            const left = parseInt(draggable.style.left);
            const qrSize = parseInt(draggable.style.width);
            const canvasW = canvasWInput.value || 600;
            const imgH = baseImg.offsetHeight; // Lấy chiều cao thực tế của ảnh nền
            const bSrc = baseImg.src;
            const qSrc = draggable.src;

            // Tính toán khoảng cách dưới để ép chiều cao cho Table
            const bottomSpacer = imgH - top - qrSize;

            // CODE "BULLETPROOF" CHO EMAIL MARKETING
            const fullHtml = `<!-- Khung bao chuẩn Table chống vỡ cấu trúc -->
<table border="0" cellpadding="0" cellspacing="0" role="presentation" width="${canvasW}" style="width:${canvasW}px; margin:0 auto;">
  <tr>
    <td background="${bSrc}" bgcolor="#ffffff" width="${canvasW}" height="${imgH}" valign="top" style="background-image: url('${bSrc}'); background-repeat: no-repeat; background-size: ${canvasW}px auto; vertical-align: top;">
      <!--[if gte mso 9]>
      <v:rect xmlns:v="urn:schemas-microsoft-com:vml" fill="true" stroke="false" style="width:${canvasW}px;height:${imgH}px;">
        <v:fill type="frame" src="${bSrc}" color="#ffffff" />
        <v:textbox inset="0,0,0,0">
      <![endif]-->
      <div style="line-height: 0; font-size: 1px;">
        <div style="padding-top: ${top}px; padding-left: ${left}px;">
          <table border="0" cellpadding="0" cellspacing="0" role="presentation" width="${qrSize}" style="width:${qrSize}px;">
            <tr>
              <td>
                <img src="${qSrc}" width="${qrSize}" height="${qrSize}" border="0" style="display: block; width: ${qrSize}px; height: ${qrSize}px; border: 0;" alt="QR Code">
              </td>
            </tr>
          </table>
        </div>
        <!-- Spacer đẩy chiều cao cho đồng bộ mọi Client Mail -->
        <div style="height: ${Math.max(0, bottomSpacer)}px; line-height: ${Math.max(0, bottomSpacer)}px; font-size: 1px;">&nbsp;</div>
      </div>
      <!--[if gte mso 9]>
        </v:textbox>
      </v:rect>
      <![endif]-->
    </td>
  </tr>
</table>`;
            
            const el = document.createElement('textarea');
            el.value = fullHtml;
            document.body.appendChild(el);
            el.select();
            document.execCommand('copy');
            document.body.removeChild(el);
            
            toast.style.opacity = '1';
            setTimeout(() => { toast.style.opacity = '0'; }, 3000);
        });

        // Đợi ảnh load xong để tính toán chiều cao chính xác
        baseImg.onload = updateDisplay;
        updateDisplay();
    </script>
</body>
</html>
