<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Công cụ xác định tọa độ QR Code - Ultra Stable Edition</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Lexend+Deca:wght@300;400;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Lexend Deca', sans-serif;
            font-weight: 300;
        }
        #draggable {
            cursor: move;
            user-select: none;
            border: 2px dashed #3b82f6;
            z-index: 50;
            aspect-ratio: 1 / 1; 
        }
        .canvas-container {
            background-image: radial-gradient(#cbd5e1 1px, transparent 1px);
            background-size: 20px 20px;
        }
        input[type=range] {
            height: 6px;
            -webkit-appearance: none;
            width: 100%;
            background: #d1d5db;
            border-radius: 5px;
        }
        input[type=range]::-webkit-slider-thumb {
            -webkit-appearance: none;
            height: 18px;
            width: 18px;
            border-radius: 50%;
            background: #3b82f6;
            cursor: pointer;
        }
        .sig-preview p, .sig-preview span { 
            font-family: 'Lexend Deca', sans-serif;
            font-weight: 300;
            margin-bottom: 0; 
            line-height: 1.4; 
        }
    </style>
</head>
<body class="bg-slate-100 min-h-screen p-4 md:p-8 text-slate-800">

    <div class="max-w-7xl mx-auto bg-white rounded-2xl shadow-2xl overflow-hidden flex flex-col md:flex-row min-h-[85vh]">
        <!-- Sidebar -->
        <div class="w-full md:w-80 p-6 bg-slate-50 border-r border-slate-200 flex flex-col gap-6">
            <div>
                <h2 class="text-xl font-bold text-slate-900 mb-1 border-b-2 border-blue-500 pb-2">Cấu hình Email</h2>
                <p class="text-[11px] text-slate-500 italic mt-2 text-blue-600 font-bold uppercase tracking-tight">Kỹ thuật Table-Padding (Chống lệch)</p>
            </div>
            
            <div class="space-y-5 overflow-y-auto max-h-[65vh] pr-2">
                <!-- 1. Cấu hình Ảnh -->
                <div class="bg-white p-4 rounded-xl shadow-sm border border-slate-200 space-y-3">
                    <div>
                        <label class="text-[10px] text-slate-500 font-bold uppercase tracking-tighter">Link Ảnh nền</label>
                        <input type="text" id="bg-url-input" value="https://res.cloudinary.com/dzv2r1azb/image/upload/69b5488815b89ae6c3a9_rq7tii" class="w-full border rounded-md px-2 py-1 font-mono text-[10px] text-slate-600 outline-none focus:ring-1 focus:ring-blue-400">
                    </div>
                    <div>
                        <label class="text-[10px] text-slate-500 font-bold uppercase tracking-tighter">Link QR Code</label>
                        <input type="text" id="qr-url-input" value="https://res.cloudinary.com/dzv2r1azb/image/upload/v1766729747/qr-generator/qr_1766729746571_1.png" class="w-full border rounded-md px-2 py-1 font-mono text-[10px] text-slate-600 outline-none focus:ring-1 focus:ring-blue-400">
                    </div>
                </div>

                <!-- 2. Kích thước -->
                <div class="bg-white p-4 rounded-xl shadow-sm border border-slate-200">
                    <div class="flex justify-between items-center gap-2 mb-3">
                        <span class="text-xs font-bold text-slate-400 uppercase">Rộng khung:</span>
                        <input type="number" id="canvas-w" value="600" class="w-20 text-right border rounded-md px-2 py-1 font-mono text-blue-600 outline-none">
                    </div>
                    <button id="autofit-btn" class="w-full py-2 text-[10px] bg-blue-50 text-blue-700 hover:bg-blue-100 rounded font-black uppercase transition-all">
                        Khớp khung với ảnh gốc
                    </button>
                </div>

                <!-- 3. Tọa độ -->
                <div class="grid grid-cols-2 gap-3">
                    <div class="bg-white p-3 rounded-xl border border-slate-200 text-center">
                        <p class="text-[10px] text-slate-400 uppercase font-black mb-1 tracking-widest">Top</p>
                        <p id="top-val" class="text-lg font-mono text-slate-700 font-bold">0</p>
                    </div>
                    <div class="bg-white p-3 rounded-xl border border-slate-200 text-center">
                        <p class="text-[10px] text-slate-400 uppercase font-black mb-1 tracking-widest">Left</p>
                        <p id="left-val" class="text-lg font-mono text-slate-700 font-bold">0</p>
                    </div>
                </div>

                <!-- 4. Size QR -->
                <div class="bg-white p-4 rounded-xl shadow-sm border border-slate-200">
                    <div class="flex justify-between items-center mb-2">
                        <p class="text-xs text-slate-400 uppercase font-bold">Size QR (px)</p>
                        <input type="number" id="size-input" value="100" class="w-16 text-right border border-slate-200 rounded px-1 text-blue-600 font-mono font-bold">
                    </div>
                    <input type="range" id="size-range" min="20" max="400" value="100" class="cursor-pointer">
                </div>

                <div class="pt-2">
                    <button id="copy-btn" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-4 px-4 rounded-xl shadow-lg transition-all active:scale-95 flex flex-col items-center gap-1">
                        <div class="flex items-center gap-2">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                                <path d="M8 3a1 1 0 011-1h2a1 1 0 110 2H9a1 1 0 01-1-1z" />
                                <path d="M6 3a2 2 0 00-2 2v11a2 2 0 002 2h8a2 2 0 002-2V5a2 2 0 00-2-2 3 3 0 01-3 3H9a3 3 0 01-3-3z" />
                            </svg>
                            <span>COPY BULLETPROOF CODE</span>
                        </div>
                        <span class="text-[10px] font-normal opacity-80">(Stable Table-Padding)</span>
                    </button>
                    <p id="toast" class="mt-3 text-center text-green-600 font-bold opacity-0 transition-opacity text-sm bg-green-50 py-1 rounded-full border border-green-100">Đã copy mã chống lệch!</p>
                </div>
            </div>
        </div>

        <!-- Workspace -->
        <div class="flex-1 p-6 flex flex-col items-center justify-start overflow-auto canvas-container bg-slate-100">
            <div id="email-mockup" class="bg-white shadow-2xl border border-slate-300" style="width: 600px; margin: 0 auto;">
                <div id="container" class="relative overflow-hidden" style="width: 600px; margin: 0 auto;">
                    <img src="https://res.cloudinary.com/dzv2r1azb/image/upload/69b5488815b89ae6c3a9_rq7tii" 
                         alt="Background" 
                         class="w-full h-auto pointer-events-none block"
                         id="base-img">
                    
                    <img id="draggable" 
                         src="https://res.cloudinary.com/dzv2r1azb/image/upload/v1766729747/qr-generator/qr_1766729746571_1.png" 
                         style="position:absolute; top: 100px; left: 100px; width: 100px; height: 100px;"
                         alt="QR Code">
                </div>

                <!-- SIGNATURE -->
                <div class="p-8 text-slate-600 bg-white border-t border-slate-100 sig-preview text-left">
                    <div style='font-family: "Lexend Deca", sans-serif; font-weight: 300; font-size: 8pt;'>
                        <div style="border-top: 1px solid #201F1E; width: 120px; margin: 5px 0 4px 0;"></div>
                        <p style="color:#002060; font-weight: 700;">Administration Dept.</p>
                        <p style="color:blue; text-decoration: underline;">administration@coteccons.vn</p>
                        <div class="mt-1 mb-4">
                            <img src="https://res.cloudinary.com/dzv2r1azb/image/upload/Picture1_y70qor" width="100%" style="max-width: 100%; height: auto; display: block;" alt="Signature Image">
                        </div>
                        <p style="color:black; font-weight: 700;">COTECCONS CONSTRUCTION JOINT STOCK COMPANY</p>
                        <p style="color:#595959;">236/6 Dien Bien Phu St., Gia Dinh Ward, Ho Chi Minh City</p>
                        <p style="color:#595959;">(+84) 28 3514 2255</p>
                        <p style="color:#595959;">0303443233 (Tax Code)</p>
                        <p style="color:blue; text-decoration: underline;">www.coteccons.vn</p>
                    </div>
                </div>
            </div>
            <p class="mt-4 text-[11px] text-slate-400 uppercase tracking-widest font-bold font-mono text-center">Kéo QR và bấm Copy để lấy mã ổn định nhất</p>
        </div>
    </div>

    <script>
        const draggable = document.getElementById('draggable');
        const container = document.getElementById('container');
        const emailMockup = document.getElementById('email-mockup');
        const topDisplay = document.getElementById('top-val');
        const leftDisplay = document.getElementById('left-val');
        const copyBtn = document.getElementById('copy-btn');
        const toast = document.getElementById('toast');
        const sizeInput = document.getElementById('size-input');
        const sizeRange = document.getElementById('size-range');
        const canvasWInput = document.getElementById('canvas-w');
        const baseImg = document.getElementById('base-img');
        const bgUrlInput = document.getElementById('bg-url-input');
        const qrUrlInput = document.getElementById('qr-url-input');
        const autofitBtn = document.getElementById('autofit-btn');

        let isDragging = false;
        let startX, startY, startTop, startLeft;

        function updateDisplay() {
            topDisplay.innerText = Math.round(parseFloat(draggable.style.top)) || 0;
            leftDisplay.innerText = Math.round(parseFloat(draggable.style.left)) || 0;
        }

        function updateSize(newSize) {
            newSize = Math.max(10, Math.min(500, newSize));
            draggable.style.width = newSize + 'px';
            draggable.style.height = newSize + 'px';
            sizeInput.value = newSize;
            sizeRange.value = newSize;
            updateDisplay();
        }

        function setCanvasWidth(val) {
            container.style.width = val + 'px';
            emailMockup.style.width = val + 'px';
            canvasWInput.value = val;
            updateDisplay();
        }

        canvasWInput.addEventListener('input', () => setCanvasWidth(canvasWInput.value || 600));
        autofitBtn.addEventListener('click', () => setCanvasWidth(baseImg.naturalWidth || 600));
        
        bgUrlInput.addEventListener('input', () => { baseImg.src = bgUrlInput.value; });
        qrUrlInput.addEventListener('input', () => { draggable.src = qrUrlInput.value; });

        sizeRange.addEventListener('input', (e) => updateSize(e.target.value));
        sizeInput.addEventListener('change', (e) => updateSize(e.target.value));

        draggable.addEventListener('mousedown', (e) => {
            isDragging = true;
            startX = e.clientX;
            startY = e.clientY;
            startTop = parseInt(draggable.style.top) || 0;
            startLeft = parseInt(draggable.style.left) || 0;
            e.preventDefault();
        });

        window.addEventListener('mousemove', (e) => {
            if (!isDragging) return;
            draggable.style.top = (startTop + (e.clientY - startY)) + 'px';
            draggable.style.left = (startLeft + (e.clientX - startX)) + 'px';
            updateDisplay();
        });

        window.addEventListener('mouseup', () => isDragging = false);

        copyBtn.addEventListener('click', () => {
            const top = parseInt(draggable.style.top) || 0;
            const left = parseInt(draggable.style.left) || 0;
            const qrSize = parseInt(draggable.style.width) || 100;
            const canvasW = canvasWInput.value || 600;
            const imgH = baseImg.offsetHeight;
            const bSrc = baseImg.src;
            const qSrc = draggable.src;
            
            // Tính toán khoảng trống bên dưới để ép chiều cao cho Table (fix lỗi bị cắt)
            const bottomSpacer = imgH - top - qrSize;

            const fullHtml = `<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <link href="https://fonts.googleapis.com/css2?family=Lexend+Deca:wght@300;700&display=swap" rel="stylesheet">
  <style>
    * { font-family: 'Lexend+Deca', 'Lexend Deca', sans-serif !important; }
  </style>
</head>
<body style="margin:0; padding:0;">
  <table width="100%" border="0" cellpadding="0" cellspacing="0">
    <tr>
      <td align="left">
        <!-- KHỐI ẢNH NỀN VÀ QR (TABLE-PADDING TECHNIQUE) -->
        <table border="0" cellpadding="0" cellspacing="0" role="presentation" width="${canvasW}" style="width:${canvasW}px; border-collapse: collapse;">
          <tr>
            <td background="${bSrc}" bgcolor="#ffffff" width="${canvasW}" height="${imgH}" valign="top" style="background-image: url('${bSrc}'); background-repeat: no-repeat; background-size: 100% auto; vertical-align: top;">
              <!--[if gte mso 9]>
              <v:rect xmlns:v="urn:schemas-microsoft-com:vml" fill="true" stroke="false" style="width:${canvasW}px;height:${imgH}px;">
                <v:fill type="frame" src="${bSrc}" color="#ffffff" />
                <v:textbox inset="0,0,0,0">
              <![endif]-->
              <div style="line-height: 0; font-size: 0;">
                <div style="padding-top: ${top}px; padding-left: ${left}px;">
                  <table border="0" cellpadding="0" cellspacing="0" role="presentation" width="${qrSize}" style="width:${qrSize}px; border-collapse: collapse;">
                    <tr>
                      <td style="line-height: 0; font-size: 0;">
                        <img src="${qSrc}" width="${qrSize}" height="${qrSize}" border="0" style="display: block; width: ${qrSize}px; height: ${qrSize}px; border: 0;" alt="QR">
                      </td>
                    </tr>
                  </table>
                </div>
                <!-- Spacer ép chiều cao để ảnh nền không bị cắt -->
                <div style="height: ${Math.max(0, bottomSpacer)}px; line-height: ${Math.max(0, bottomSpacer)}px; font-size: 1px;">&nbsp;</div>
              </div>
              <!--[if gte mso 9]></v:textbox></v:rect><![endif]-->
            </td>
          </tr>
        </table>
        
        <!-- SIGNATURE AREA -->
        <div id="Signature" style="font-family: 'Lexend Deca', sans-serif; font-weight: 300; text-align: left; padding-top: 10px;">
          <div style="border-top: 1px solid #201F1E; width: 120px; margin: 5px 0 4px 0; line-height: 0; font-size: 0;">&nbsp;</div>
          <p style='margin:0;'><b><span style='font-size:8.0pt;color:#002060;font-weight:700;'>Administration Dept.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></b></p>
          <p style='margin:0;'><u><span style='font-size:8.0pt;color:blue;'><a href="mailto:administration@coteccons.vn" style="color:blue;text-decoration:underline;">administration@coteccons.vn</a></span></u></p>
          <div style="width: 100%; max-width: ${canvasW}px; margin-top: 2px; line-height: 0;">
            <img border="0" width="${canvasW}" src="https://res.cloudinary.com/dzv2r1azb/image/upload/Picture1_y70qor" style='max-width:100%; height:auto; display:block; margin:0; border:0;'>
          </div>
          <p style='margin:0;'><b><span style='font-size:8.0pt;color:black;font-weight:700;'>COTECCONS CONSTRUCTION JOINT STOCK COMPANY</span></b></p>
          <p style='margin:0;'><span style='font-size:8.0pt;color:#595959;'>236/6 Dien Bien Phu St., Gia Dinh Ward, Ho Chi Minh City</span></p>
          <p style='margin:0;'><span style='font-size:8.0pt;color:#595959;'>(+84) 28 3514 2255</span></p>
          <p style='margin:0;'><span style='font-size:8.0pt;color:#595959;'>0303443233 (Tax Code)</span></p>
          <p style='margin:0;'><u><span style='font-size:8.0pt;color:blue;'><a href="http://www.coteccons.vn/" style="color:blue;text-decoration:underline;">www.coteccons.vn</a></span></u></p>
          <p style='margin-top:10px; text-align:justify; font-size:8pt; color:#767171;'>The contents of this email and any attachments are confidential and intended solely for the use of the individual or entity as addressed recipient(s). If you are not the intended recipient, do not copy, disseminate, or use it for any purpose or disclose its contents. Please delete this email and notify the sender immediately if you have received this in error.</p>
          <p style='margin-top:5px; margin-bottom:8.0pt; text-align:justify; font-size:8pt; color:#767171;'>Please consider the environment before printing this email.</p>
        </div>
      </td>
    </tr>
  </table>
</body>
</html>`;
            
            const el = document.createElement('textarea');
            el.value = fullHtml;
            document.body.appendChild(el);
            el.select();
            document.execCommand('copy');
            document.body.removeChild(el);
            
            toast.style.opacity = '1';
            setTimeout(() => { toast.style.opacity = '0'; }, 3000);
        });

        baseImg.onload = () => {
            updateDisplay();
        };
        updateDisplay();
    </script>
</body>
</html>
